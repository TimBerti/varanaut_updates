import requests
import json
from tqdm import tqdm


def update_etfs(db, etf_tickers, API_URL, API_TOKEN):
    '''
    Updates etf table
    '''

    tickers = ['A','AA','AAIC','AAL','AAMC','AAME','AAN','AAOI','AAON','AAP','AAPL','AAT','AATC','AAWW','ABBV','ABC','ABCB','ABEO','ABG','ABIO','ABM','ABMD','ABNB','ABOS','ABR','ABSI','ABT','ABTX','ABUS','ABVC','AC','ACA','ACAD','ACBI','ACC','ACCD','ACCO','ACEL','ACER','ACET','ACGL','ACHC','ACHV','ACIW','ACLS','ACM','ACMR','ACN','ACNB','ACOR','ACR','ACRE','ACRS','ACRX','ACTG','ACU','ACVA','ADBE','ADC','ADES','ADGI','ADI','ADIL','ADM','ADMA','ADMP','ADN','ADNT','ADP','ADPT','ADS','ADSK','ADT','ADTN','ADTX','ADUS','ADV','ADVM','ADXS','AE','AEE','AEHR','AEI','AEIS','AEL','AEMD','AEO','AEP','AERI','AES','AESE','AEVA','AEY','AEYE','AFBI','AFCG','AFG','AFI','AFIB','AFIN','AFL','AFMD','AFRM','AGCO','AGE','AGEN','AGFS','AGFY','AGIO','AGL','AGLE','AGM','AGNC','AGO','AGR','AGRX','AGS','AGTC','AGTI','AGX','AGYS','AHCO','AHH','AHPI','AHT','AI','AIG','AIKI','AIM','AIMC','AIN','AINC','AIR','AIRC','AIRG','AIRI','AIRT','AIT','AIV','AIZ','AJG','AJRD','AJX','AKA','AKAM','AKBA','AKR','AKRO','AKTS','AKUS','AKYA','AL','ALB','ALBO','ALCO','ALDX','ALE','ALEC','ALEX','ALF','ALG','ALGM','ALGN','ALGS','ALGT','ALHC','ALIM','ALIT','ALJJ','ALK','ALKS','ALKT','ALL','ALLE','ALLK','ALLO','ALLY','ALNA','ALNY','ALOT','ALPN','ALRM','ALRN','ALRS','ALSN','ALT','ALTA','ALTG','ALTM','ALTO','ALTR','ALVR','ALX','ALXN','ALXO','AM','AMAL','AMAT','AMBA','AMBC','AMC','AMCX','AMD','AME','AMED','AMEH','AMG','AMGN','AMH','AMK','AMKR','AMN','AMNB','AMOT','AMP','AMPE','AMPG','AMPH','AMPL','AMPY','AMR','AMRC','AMRK','AMRS','AMRX','AMS','AMSC','AMSF','AMST','AMSWA','AMT','AMTB','AMTI','AMTX','AMWD','AMWL','AMZN','AN','ANAB','ANAT','ANDE','ANET','ANF','ANGI','ANGN','ANGO','ANIK','ANIP','ANIX','ANNX','ANSS','ANTM','ANVS','AOMR','AON','AOS','AOSL','AOUT','AP','APA','APAM','APD','APDN','APEI','APEN','APG','APH','APLE','APLS','APLT','APO','APOG','APP','APPF','APPH','APPN','APPS','APR','APRE','APRN','APT','APTS','APTV','APTX','APVO','APYX','AQB','AQMS','AQST','AQUA','AR','ARAV','ARAY','ARC','ARCB','ARCH','ARCT','ARD','ARDS','ARDX','ARE','AREC','ARES','ARGO','ARI','ARKO','ARKR','ARLO','ARMK','ARMP','ARNA','ARNC','AROC','AROW','ARQT','ARR','ARRY','ARTL','ARTNA','ARVN','ARW','ARWR','ASAN','ASB','ASGN','ASH','ASIX','ASLE','ASMB','ASML','ASO','ASPN','ASPS','ASPU','ASRT','ASRV','ASTC','ASTE','ASTS','ASUR','ASXC','ASYS','ATC','ATCX','ATEC','ATEN','ATER','ATEX','ATGE','ATH','ATHA','ATHX','ATI','ATIP','ATKR','ATLC','ATLO','ATNF','ATNI','ATNM','ATNX','ATO','ATOM','ATOS','ATR','ATRA','ATRC','ATRI','ATRO','ATRS','ATSG','ATUS','ATVI','ATXI','AUB','AUBN','AUD','AUMN','AUTO','AUUD','AUVI','AVA','AVAH','AVAV','AVB','AVCO','AVCT','AVD','AVEO','AVGO','AVGR','AVID','AVIR','AVLR','AVNS','AVNT','AVNW','AVO','AVPT','AVRO','AVT','AVTE','AVTR','AVTX','AVXL','AVY','AVYA','AWH','AWI','AWK','AWR','AWRE','AX','AXDX','AXGN','AXL','AXLA','AXNX','AXON','AXP','AXR','AXS','AXSM','AXTA','AXTI','AYI','AYTU','AYX','AZEK','AZO','AZPN','AZYO','AZZ','B','BA','BAC','BAH','BALY','BANC','BAND','BANF','BANR','BARK','BASE','BAT','BATL','BATRA','BATRK','BAX','BBBY','BBCP','BBGI','BBI','BBIO','BBQ','BBSI','BBW','BBY','BC','BCAB','BCBP','BCC','BCDA','BCEI','BCEL','BCLI','BCML','BCO','BCOR','BCOV','BCOW','BCPC','BCRX','BDC','BDL','BDN','BDSI','BDSX','BDTX','BDX','BE','BEAM','BECN','BEEM','BELFA','BELFB','BEN','BERY','BF-A','BFAM','BF-B','BFC','BFI','BFIN','BFLY','BFS','BFST','BG','BGCP','BGFV','BGRY','BGS','BGSF','BH','BH-A','BHB','BHE','BHF','BHG','BHLB','BHR','BHVN','BIG','BIGC','BIIB','BILL','BIO','BIOC','BIOL','BIPC','BIVI','BJ','BJRI','BK','BKD','BKE','BKH','BKI','BKNG','BKR','BKSC','BKTI','BKU','BKYI','BL','BLBD','BLCM','BLD','BLDE','BLDR','BLFS','BLFY','BLI','BLIN','BLK','BLKB','BLL','BLMN','BLNK','BLPH','BLUE','BLX','BMBL','BMEA','BMI','BMRA','BMRC','BMRN','BMTC','BMTX','BMY','BNED','BNFT','BNGO','BNL','BOH','BOKF','BOLT','BOMN','BOOM','BOOT','BOX','BOXL','BPMC','BPOP','BPRN','BPTH','BPYU','BR','BRBR','BRBS','BRC','BRDG','BRG','BRID','BRK','BRK-A','BRK-B','BRKL','BRKR','BRLT','BRMK','BRO','BROS','BRP','BRSP','BRT','BRX','BRY','BSBK','BSET','BSGM','BSIG','BSQR','BSRR','BSVN','BSX','BSY','BTAI','BTN','BTRS','BTU','BTX','BURL','BUSE','BV','BVH','BVS','BW','BWA','BWB','BWEN','BWFG','BWMN','BWXT','BX','BXC','BXMT','BXP','BXRX','BXS','BY','BYD','BYFC','BYND','BYRN','BYSI','BZH','C','CABA','CABO','CAC','CACC','CACI','CADE','CADL','CAG','CAH','CAI','CAKE','CAL','CALA','CALB','CALM','CALX','CAMP','CANO','CAPR','CAR','CARA','CARE','CARG','CARR','CARS','CARV','CASA','CASH','CASI','CASS','CASY','CAT','CATC','CATO','CATY','CB','CBAN','CBAY','CBB','CBFV','CBIO','CBMB','CBNK','CBOE','CBRE','CBRL','CBSH','CBT','CBTX','CBU','CBZ','CC','CCB','CCBG','CCCC','CCCS','CCF','CCI','CCK','CCL','CCMP','CCNE','CCO','CCOI','CCRD','CCRN','CCS','CCSI','CCXI','CDAK','CDAY','CDE','CDEV','CDK','CDLX','CDMO','CDNA','CDNS','CDOR','CDR','CDTX','CDW','CDXC','CDXS','CDZI','CE','CECE','CEI','CEIX','CELC','CELH','CEMI','CENT','CENTA','CENX','CERC','CERE','CERN','CERS','CERT','CETX','CEVA','CF','CFB','CFBK','CFFI','CFFN','CFG','CFLT','CFMS','CFR','CFRX','CFX','CG','CGEM','CGNX','CGRN','CHCI','CHCO','CHCT','CHD','CHDN','CHE','CHEF','CHGG','CHH','CHK','CHMG','CHMI','CHNG','CHPT','CHRA','CHRS','CHRW','CHS','CHTR','CHUY','CHWY','CHX','CI','CIA','CIDM','CIEN','CIM','CINF','CIO','CIR','CIT','CIVB','CIVI','CIX','CIZN','CKPT','CL','CLAR','CLB','CLBK','CLBS','CLDR','CLDT','CLDX','CLF','CLFD','CLGX','CLH','CLI','CLIR','CLNE','CLNN','CLNY','CLOV','CLPR','CLPT','CLR','CLRB','CLRO','CLSD','CLSK','CLSN','CLVS','CLW','CLX','CLXT','CMA','CMAX','CMBM','CMC','CMCO','CMCSA','CMCT','CMD','CME','CMG','CMI','CMLS','CMO','CMP','CMPI','CMPR','CMRE','CMRX','CMS','CMT','CMTL','CNA','CNBKA','CNC','CNCE','CNDT','CNI','CNK','CNM','CNMD','CNNE','CNO','CNOB','CNP','CNR','CNS','CNSL','CNSP','CNTY','CNVY','CNX','CNXC','CNXN','COCP','CODA','CODX','COF','COFS','COG','COGT','COHR','COHU','COIN','COKE','COLB','COLD','COLL','COLM','COMM','COMP','COMS','CONE','CONN','COO','COOK','COOP','COP','COR','CORE','CORR','CORT','COST','COTY','COUP','COUR','COWN','CPA','CPB','CPE','CPF','CPHC','CPIX','CPK','CPLG','CPRI','CPRT','CPRX','CPS','CPSH','CPSI','CPSS','CPT','CR','CRAI','CRBP','CRBU','CRC','CRCT','CRD-A','CRD-B','CRDF','CREX','CRI','CRIS','CRK','CRKN','CRL','CRM','CRMD','CRMT','CRNC','CRNX','CROX','CRS','CRSR','CRTD','CRTX','CRUS','CRVL','CRVS','CRWD','CRWS','CRY','CSBR','CSCO','CSGP','CSGS','CSII','CSL','CSLT','CSOD','CSPI','CSPR','CSR','CSSE','CSTE','CSTL','CSTM','CSTR','CSV','CSWI','CSX','CTAS','CTBI','CTEK','CTG','CTHR','CTIC','CTKB','CTLP','CTLT','CTMX','CTO','CTOS','CTRA','CTRE','CTRN','CTS','CTSH','CTSO','CTT','CTVA','CTXR','CTXS','CUBE','CUBI','CUE','CULL','CULP','CURI','CURO','CURV','CUTR','CUZ','CVA','CVBF','CVCO','CVCY','CVET','CVGI','CVGW','CVI','CVLG','CVLT','CVLY','CVM','CVNA','CVR','CVRX','CVS','CVU','CVV','CVX','CW','CWAN','CWBC','CWBR','CWEN','CWH','CWK','CWST','CWT','CXDO','CXM','CXP','CXW','CY','CYBE','CYCC','CYCN','CYH','CYRX','CYT','CYTH','CYTK','CYXT','CZNC','CZR','CZWI','D','DAIO','DAKT','DAL','DAN','DAR','DARE','DASH','DATA','DAWN','DBD','DBI','DBRG','DBTX','DBX','DCI','DCO','DCOM','DCPH','DCT','DCTH','DD','DDD','DDOG','DDS','DE','DEA','DECK','DEI','DELL','DEN','DEO','DENN','DFFN','DFH','DFIN','DFS','DG','DGICA','DGII','DGLY','DGX','DH','DHC','DHI','DHIL','DHR','DHT','DHX','DIBS','DIN','DIOD','DIS','DISCA','DISCK','DISH','DIT','DJCO','DK','DKNG','DKS','DLA','DLB','DLHC','DLPN','DLR','DLTH','DLTR','DLX','DM','DMAC','DMRC','DMS','DMTK','DNAY','DNB','DNLI','DNMR','DNOW','DNUT','DOC','DOCN','DOCS','DOCU','DOMA','DOMO','DOOR','DORM','DOV','DOW','DOX','DPZ','DRE','DRH','DRI','DRIO','DRNA','DRQ','DRRX','DRSHF','DRVN','DS','DSGN','DSKE','DSP','DSPG','DSS','DT','DTE','DTIL','DTM','DUK','DUOL','DUOT','DV','DVA','DVAX','DVD','DVN','DWSN','DX','DXC','DXCM','DXPE','DXR','DXYN','DY','DYAI','DYN','DZSI','EA','EAF','EAR','EARN','EAST','EAT','EB','EBAY','EBC','EBET','EBF','EBIX','EBMT','EBS','EBSB','EBTC','ECHO','ECL','ECOL','ECOM','ECOR','ECPG','ECVT','ED','EDIT','EDR','EDUC','EEFT','EEX','EFC','EFOI','EFSC','EFX','EGAN','EGBN','EGHT','EGLE','EGN','EGP','EGRX','EGY','EHC','EHTH','EIG','EIGR','EIX','EKSO','EL','ELA','ELAN','ELDN','ELEV','ELF','ELMD','ELMS','ELOX','ELS','ELVT','ELY','ELYM','EMAN','EMCF','EME','EMKR','EML','EMN','EMR','ENDP','ENG','ENPH','ENR','ENS','ENSG','ENTA','ENTG','ENV','ENVA','ENVB','ENZ','EOG','EOLS','EOSE','EPAC','EPAM','EPAY','EPC','EPM','EPR','EPRT','EPSN','EPZM','EQ','EQBK','EQC','EQH','EQIX','EQR','EQT','ERAS','ERIE','ERII','ES','ESBK','ESCA','ESE','ESGC','ESGR','ESI','ESMT','ESNT','ESP','ESPR','ESQ','ESRT','ESS','ESSA','ESTC','ESTE','ETD','ETH','ETN','ETNB','ETON','ETR','ETRN','ETSY','ETTX','ETWO','EV','EVBG','EVBN','EVC','EVCM','EVER','EVFM','EVH','EVHC','EVI','EVLO','EVOK','EVOL','EVOP','EVR','EVRG','EVRI','EVTC','EW','EWBC','EWCZ','EWTX','EXAS','EXC','EXEL','EXLS','EXP','EXPD','EXPE','EXPI','EXPO','EXPR','EXR','EXTN','EXTR','EYE','EYEN','EYES','EYPT','EZPW','F','FA','FAF','FANG','FARM','FARO','FAST','FAT','FATBB','FATE','FB','FBC','FBHS','FBIO','FBIZ','FBK','FBMS','FBNC','FBP','FBRT','FBRT_old','FBRX','FC','FCAP','FCBC','FCCO','FCCY','FCEL','FCF','FCFS','FCN','FCNCA','FCPT','FCX','FDBC','FDC','FDMT','FDP','FDS','FDX','FE','FEIM','FELE','FET','FEYE','FF','FFBC','FFBW','FFIC','FFIE','FFIN','FFIV','FFNW','FFWM','FGBI','FGEN','FGF','FHB','FHI','FHN','FHTX','FI','FIBK','FICO','FIGS','FIS','FISI','FISV','FITB','FIVE','FIVN','FIX','FIXX','FIZZ','FKWL','FL','FLDM','FLGT','FLIC','FLIR','FLL','FLMN','FLNT','FLO','FLOW','FLR','FLS','FLT','FLUX','FLWS','FLXN','FLXS','FLYW','FMAO','FMBH','FMBI','FMC','FMNB','FMTX','FN','FNB','FNCB','FNCH','FND','FNF','FNHC','FNKO','FNLC','FNWB','FOA','FOCS','FOE','FOLD','FONR','FOR','FORA','FORD','FORG','FORM','FORR','FOSL','FOUR','FOX','FOXA','FOXF','FPAY','FPI','FR','FRAF','FRBA','FRBK','FRC','FRD','FREE','FREQ','FRG','FRGI','FRME','FRO','FROG','FRPH','FRPT','FRSH','FRST','FRT','FRTA','FSBC','FSBW','FSFG','FSI','FSLR','FSLY','FSP','FSR','FSS','FSTR','FSTX','FTCI','FTDR','FTEK','FTHM','FTK','FTNT','FTNW','FTSI','FTV','FUBO','FUL','FULC','FULT','FUNC','FUSB','FUV','FVCB','FVE','FWBI','FWONA','FWONK','FWRD','FXLV','FXNC','FYBR','G','GABC','GAIA','GALT','GAN','GATO','GATX','GBCI','GBIO','GBL','GBNY','GBOX','GBR','GBT','GBX','GCBC','GCI','GCMG','GCO','GCP','GD','GDDY','GDEN','GDI','GDOT','GDP','GDRX','GDYN','GE','GEF','GEF-B','GEG','GENC','GEO','GEOS','GERN','GES','GEVO','GFF','GGG','GH','GHC','GHL','GHLD','GHM','GHSI','GIC','GIFI','GIII','GILD','GIS','GKOS','GL','GLDD','GLIBA','GLNG','GLPI','GLRE','GLSI','GLT','GLUE','GLW','GLYC','GM','GME','GMED','GMRE','GMS','GMTX','GNCA','GNE','GNK','GNL','GNLN','GNOG','GNPX','GNRC','GNSS','GNTX','GNTY','GNUS','GNW','GO','GOCO','GOED','GOEV','GOGO','GOLF','GOOD','GOOG','GOOGL','GORO','GOSS','GOVX','GPC','GPI','GPK','GPMT','GPN','GPOR','GPRE','GPRO','GPS','GPX','GRA','GRAY','GRBK','GRC','GREE','GRIL','GRMN','GROW','GRPH','GRPN','GRTS','GRTX','GRUB','GRWG','GS','GSAT','GSBC','GSHD','GSIT','GSKY','GT','GTBP','GTES','GTHX','GTIM','GTLS','GTN','GTS','GTY','GTYH','GVA','GVP','GWB','GWR','GWRE','GWRS','GWW','GXO','H','HA','HAE','HAFC','HAIN','HAL','HALL','HALO','HARP','HAS','HASI','HAYN','HAYW','HBAN','HBB','HBCP','HBI','HBIO','HBMD','HBNC','HBP','HBT','HCA','HCAT','HCC','HCCI','HCDI','HCHC','HCI','HCKT','HCSG','HD','HDSN','HE','HEAR','HEES','HEI','HEI-A','HELE','HEPA','HES','HFC','HFFG','HFWA','HGBL','HGEN','HGV','HHC','HI','HIBB','HIFS','HIG','HII','HIL','HIMS','HIW','HL','HLF','HLI','HLIO','HLIT','HLLY','HLMN','HLNE','HLT','HLTH','HLX','HMHC','HMN','HMNF','HMPT','HMST','HMTV','HNGR','HNI','HNNA','HNRG','HNST','HOFT','HOFV','HOG','HOLX','HOMB','HON','HONE','HOOK','HOPE','HOTH','HOV','HOWL','HP','HPE','HPK','HPP','HPQ','HQI','HQY','HR','HRB','HRC','HRI','HRL','HRMY','HROW','HRTG','HRTX','HSC','HSDT','HSIC','HSII','HSKA','HSON','HST','HSTM','HSTO','HSY','HT','HTA','HTBI','HTBK','HTBX','HTGM','HTH','HTLD','HTLF','HUBB','HUBG','HUBS','HUM','HUMA','HUN','HURC','HURN','HVBC','HVT','HWBK','HWC','HWKN','HWM','HXL','HY','HYFM','HYLN','HYMC','HYRE','HZN','HZNP','HZO','IAA','IAC','IART','IAS','IBCP','IBEX','IBIO','IBKR','IBM','IBOC','IBP','IBRX','IBTX','ICAD','ICCC','ICD','ICE','ICFI','ICHR','ICPT','ICUI','ICVX','IDA','IDCC','IDEX','IDN','IDRA','IDT','IDXX','IDYA','IEA','IESC','IEX','IFF','IFMK','IGMS','IGT','IGT_old','IHC','IHRT','III','IIIN','IIIV','IIN','IIPR','IIVI','IKNA','IKT','ILMN','ILPT','IMAC','IMAX','IMBBF','IMBI','IMGN','IMGO','IMH','IMKTA','IMMR','IMNM','IMPL','IMRA','IMRX','IMUX','IMVT','IMXI','INAB','INBK','INBX','INCY','INDB','INDI','INDP','INDT','INFI','INFN','INFO','INFU','INGN','INGR','INMB','INN','INNV','INO','INOD','INOV','INPX','INS','INSG','INSM','INSP','INST','INSW','INT','INTA','INTC','INTG','INTT','INTU','INTZ','INUV','INVA','INVE','INVH','INVO','INZY','IO','IONS','IOSP','IOVA','IP','IPAR','IPG','IPGP','IPI','IPSC','IPWR','IQV','IR','IRBT','IRDM','IRIX','IRM','IRMD','IRNT','IROQ','IRT','IRTC','IRWD','ISBC','ISDR','ISEE','ISR','ISRG','ISSC','ISTR','ISUN','IT','ITCI','ITGR','ITI','ITIC','ITOS','ITRI','ITT','ITW','IVAC','IVC','IVR','IVZ','IZEA','J','JACK','JAGX','JAKK','JAMF','JANX','JAZZ','JBGS','JBHT','JBI','JBL','JBLU','JBSS','JBT','JCI','JCOM','JCS','JCTCF','JEC','JEF','JELD','JHG','JILL','JJSF','JKHY','JLL','JNCE','JNJ','JNPR','JOAN','JOB','JOBY','JOE','JOUT','JPM','JRSH','JRVR','JUPW','JVA','JW-A','JWN','JYNT','K','KAI','KALA','KALU','KALV','KAMN','KAR','KBAL','KBH','KBNT','KBR','KDMN','KDNY','KDP','KE','KELYA','KEQU','KERN','KEX','KEY','KEYS','KFFB','KFRC','KFS','KFY','KHC','KIDS','KIM','KINS','KIRK','KKR','KLAC','KLDO','KLIC','KLTR','KLXE','KMB','KMI','KMPH','KMPR','KMT','KMX','KN','KNBE','KNSA','KNSL','KNTE','KNTK','KNX','KO','KOD','KODK','KOP','KOPN','KOS','KOSS','KPLT','KPTI','KR','KRA','KRBP','KRC','KREF','KRG','KRMD','KRNY','KRO','KRON','KROS','KRT','KRTX','KRUS','KRYS','KSS','KSU','KTB','KTCC','KTOS','KTRA','KULR','KURA','KVHI','KW','KWR','KYMR','KZR','L','LABP','LAD','LADR','LAKE','LAMR','LANC','LAND','LARK','LASR','LAUR','LAW','LAWS','LAZ','LAZR','LAZY','LB','LBAI','LBC','LBPH','LBRDA','LBRDK','LBRT','LC','LCI','LCID','LCII','LCNB','LCTX','LCUT','LDI','LDL','LDOS','LE','LEA','LECO','LEE','LEG','LEGH','LEN','LEN-B','LESL','LEU','LEVI','LEVL','LFMD','LFST','LFT','LFUS','LFVN','LGF-A','LGF-B','LGIH','LGL','LGND','LGVN','LH','LHCG','LHDX','LHX','LIDR','LIFE','LII','LILA','LILAK','LIN','LINC','LIND','LITE','LIVE','LIVN','LIVX','LIXT','LJPC','LKFN','LKQ','LL','LLNW','LLY','LM','LMAT','LMB','LMND','LMNR','LMPX','LMST','LMT','LNC','LNDC','LNG','LNN','LNSR','LNT','LNTH','LOAN','LOB','LOCO','LODE','LOGC','LOPE','LORL','LOTZ','LOVE','LOW','LPCN','LPG','LPI','LPLA','LPRO','LPSN','LPT','LPTH','LPTX','LPX','LQDA','LQDT','LRCX','LRMR','LRN','LSBK','LSCC','LSEA','LSF','LSI','LSTR','LSXMA','LSXMK','LTBR','LTC','LTCH','LTHM','LTRN','LTRPA','LTRX','LUB','LULU','LUMN','LUMO','LUNA','LUNG','LUV','LVMHF','LVO','LVS','LW','LWAY','LXFR','LXP','LXRX','LXU','LYB','LYEL','LYFT','LYRA','LYTS','LYV','LZ','LZB','M','MA','MAA','MAC','MACK','MAN','MANH','MANT','MAPS','MAR','MARA','MARK','MAS','MASI','MASS','MAT','MATW','MATX','MAX','MAXR','MAYS','MBCN','MBI','MBII','MBIN','MBIO','MBOT','MBRX','MBUU','MBWM','MC','MCB','MCBC','MCBS','MCD','MCF','MCFE','MCFT','MCHP','MCHX','MCK','MCO','MCRB','MCRI','MCS','MCW','MCY','MD','MDB','MDC','MDCA','MDGL','MDIA','MDLZ','MDP','MDRX','MDT','MDU','MDVL','MDWT','MDXG','MEC','MED','MEDP','MEDS','MEG','MEI','MEIP','MESA','MET','META','METC','MFA','MFIN','MG','MGEE','MGI','MGLN','MGM','MGNI','MGNX','MGPI','MGRC','MGTA','MGTX','MGY','MHH','MHK','MHLD','MHO','MIC','MICT','MIDD','MIK','MILE','MIME','MIMO','MIND','MIRM','MITK','MITT','MKC','MKL','MKSI','MKTW','MKTX','MLAB','MLHR','MLI','MLKN','MLM','MLNK','MLP','MLR','MLSS','MLVF','MMAT','MMC','MMI','MMM','MMS','MMSI','MN','MNDT','MNKD','MNMD','MNOV','MNPR','MNR','MNRL','MNRO','MNSB','MNST','MNTK','MNTS','MNTV','MNTX','MO','MOD','MODN','MODV','MOFG','MOG-A','MOH','MORF','MORN','MOS','MOV','MOVE','MP','MPAA','MPB','MPC','MPLN','MPW','MPWR','MPX','MQ','MRAM','MRBK','MRC','MRCY','MRIN','MRK','MRKR','MRLN','MRNA','MRNS','MRO','MRSN','MRTN','MRTX','MRVI','MRVL','MS','MSA','MSBI','MSCI','MSEX','MSFT','MSG','MSGE','MSGM','MSGS','MSI','MSM','MSON','MSP','MSTR','MSVB','MTB','MTBC','MTCH','MTCR','MTD','MTDR','MTEM','MTEX','MTG','MTH','MTN','MTNB','MTOR','MTRN','MTRX','MTSI','MTTR','MTW','MTX','MTZ','MU','MUR','MUSA','MVBF','MVIS','MWA','MXCT','MXIM','MXL','MYE','MYFW','MYGN','MYL','MYMD','MYO','MYRG','NABL','NAII','NAOV','NAPA','NARI','NAT','NATH','NATI','NATR','NAVB','NAVI','NBEV','NBHC','NBIX','NBN','NBR','NBSE','NBTB','NBY','NC','NCBS','NCLH','NCMI','NCNO','NCR','NCSM','NDAQ','NDLS','NDRA','NDSN','NE','NECB','NEE','NEM','NEO','NEOG','NEPH','NERV','NESR','NET','NEU','NEWR','NEX','NEXI','NEXT','NFBK','NFE','NFG','NFLX','NG','NGM','NGMS','NGS','NGVC','NGVT','NH','NHC','NHI','NI','NICK','NINE','NJR','NKE','NKLA','NKSH','NKTR','NKTX','NL','NLOK','NLS','NLSN','NLTX','NLY','NMIH','NMRK','NMTR','NNBR','NNI','NNN','NNVC','NOC','NODK','NOG','NOTV','NOV','NOVA','NOVN','NOVT','NOW','NP','NPCE','NPK','NPO','NPTN','NR','NRBO','NRC','NREF','NRG','NRIM','NRIX','NRXP','NRZ','NSA','NSC','NSIT','NSP','NSSC','NSTG','NTAP','NTB','NTCT','NTGR','NTIC','NTIP','NTLA','NTNX','NTRA','NTRS','NTST','NTUS','NTWK','NUAN','NUE','NURO','NUS','NUVA','NUVB','NUVL','NUWE','NUZE','NVAX','NVCR','NVDA','NVEC','NVEE','NVIV','NVNO','NVOS','NVR','NVRO','NVST','NVT','NVTA','NVVE','NWBI','NWE','NWFL','NWL','NWLI','NWN','NWPX','NWS','NWSA','NX','NXGN','NXPI','NXRT','NXST','NXTC','NXTD','NXTP','NYC','NYCB','NYMT','NYT','O','OAS','OB','OBCI','OBLG','OBNK','OC','OCC','OCDX','OCFC','OCGN','OCN','OCUL','OCX','ODC','ODFL','ODP','ODT','OEC','OEG','OESX','OFC','OFED','OFG','OFIX','OFLX','OGE','OGEN','OGN','OGS','OHB','OHI','OI','OII','OIS','OKE','OKTA','OLB','OLED','OLLI','OLMA','OLN','OLO','OLP','OLPX','OM','OMC','OMCL','OMER','OMEX','OMF','OMGA','OMI','OMIC','ON','ONB','ONCR','ONCS','ONCT','ONDS','ONEM','ONEW','ONTF','ONTO','ONTX','ONVO','OOMA','OPBK','OPCH','OPEN','OPGN','OPI','OPK','OPNT','OPOF','OPRT','OPRX','OPTN','OPTT','OPY','ORA','ORBC','ORC','ORCL','ORGN','ORGO','ORGS','ORI','ORIC','ORLY','ORMP','ORN','ORRF','OSBC','OSCR','OSG','OSH','OSIS','OSK','OSPN','OSS','OSTK','OSUR','OSW','OTIC','OTIS','OTLK','OTRK','OTTR','OUST','OUT','OVBC','OVID','OVLY','OVV','OWL','OWLT','OXM','OXY','OYST','OZK','PACB','PACK','PACW','PAE','PAG','PAGS','PAHC','PALI','PANW','PAR','PARR','PASG','PATH','PATI','PATK','PAVM','PAY','PAYA','PAYC','PAYO','PAYS','PAYX','PB','PBCT','PBF','PBFS','PBH','PBHC','PBI','PBIP','PBLA','PBPB','PBYI','PCAR','PCB','PCG','PCH','PCOR','PCRX','PCSA','PCSB','PCT','PCTI','PCTY','PCVX','PCYG','PCYO','PD','PDCE','PDCO','PDEX','PDFS','PDLB','PDLI','PDM','PDSB','PE','PEAK','PEB','PEBK','PEBO','PECO','PED','PEG','PEGA','PEI','PEN','PENN','PEP','PESI','PETQ','PETS','PF','PFBC','PFBI','PFC','PFE','PFG','PFGC','PFHD','PFIE','PFIN','PFIS','PFMT','PFPT','PFS','PFSI','PFSW','PG','PGC','PGEN','PGNY','PGR','PGRE','PGTI','PH','PHAS','PHAT','PHIO','PHM','PHR','PHUN','PHX','PI','PII','PINC','PINE','PING','PINS','PIPR','PIXY','PJT','PK','PKBK','PKE','PKG','PKI','PKOH','PLAB','PLAN','PLAY','PLBC','PLBY','PLCE','PLD','PLM','PLMR','PLNT','PLOW','PLPC','PLRX','PLSE','PLTR','PLUG','PLUS','PLXP','PLXS','PLYM','PM','PMD','PMT','PMTS','PMVP','PNBK','PNC','PNFP','PNM','PNR','PNRG','PNT','PNTG','PNW','POAI','PODD','POLA','POLY','POOL','POR','POSH','POST','POWI','POWL','POWW','PPBI','PPC','PPG','PPIH','PPL','PPSI','PPTA','PQG','PRA','PRAA','PRAH','PRAX','PRCH','PRCT','PRDO','PRFT','PRG','PRGO','PRGS','PRI','PRIM','PRK','PRLB','PRLD','PRMW','PRO','PROG','PROS','PROV','PRPH','PRPL','PRPO','PRTA','PRTG','PRTH','PRTK','PRTS','PRTY','PRU','PRVA','PRVB','PSA','PSB','PSMT','PSN','PSNL','PSTG','PSTL','PSTV','PSTX','PSX','PTC','PTCT','PTE','PTEN','PTGX','PTN','PTON','PTPI','PTRS','PTSI','PTVE','PUBM','PULM','PUMP','PVAC','PVBC','PVH','PW','PWFL','PWOD','PWP','PWR','PWSC','PXD','PXLW','PYCR','PYPL','PZG','PZN','PZZA','QADA','QCOM','QCRH','QDEL','QGEN','QLGN','QLYS','QMCO','QNST','QRHC','QRTEA','QRVO','QS','QSI','QTNT','QTRX','QTS','QTWO','QUAD','QUBT','QUIK','QUMU','QUOT','R','RAD','RADI','RAIL','RAIN','RAMP','RANI','RAPT','RARE','RAVN','RBB','RBBN','RBC','RBCAA','RBCN','RBKB','RBLX','RBNC','RC','RCAT','RCEL','RCII','RCKT','RCKY','RCL','RCM','RCMT','RCOR','RCUS','RDFN','RDI','RDN','RDNT','RDUS','RDVT','RDW','RE','REAL','REED','REFR','REG','REGI','REGN','REI','REKR','RELL','RELY','REPH','REPL','REPX','RES','RESN','RETA','REV','REVG','REX','REXR','REYN','REZI','RF','RFIL','RFL','RFP','RGA','RGCO','RGEN','RGLD','RGLS','RGNX','RGP','RGR','RGS','RH','RHI','RHP','RIBT','RICK','RIDE','RIG','RIGL','RILY','RIO','RIOT','RJF','RKDA','RKT','RL','RLAY','RLGT','RLGY','RLI','RLJ','RLMD','RLYB','RM','RMAX','RMBI','RMBL','RMBS','RMCF','RMD','RMED','RMNI','RMO','RMR','RMTI','RNA','RNAZ','RNDB','RNG','RNGR','RNR','RNST','RNWK','ROAD','ROCC','ROCK','ROG','ROIC','ROK','ROKU','ROL','ROLL','ROOT','ROP','ROST','ROVR','RP','RPAI','RPAY','RPD','RPHM','RPID','RPM','RPRX','RPT','RRBI','RRC','RRD','RRGB','RRR','RS','RSG','RSI','RSPP','RSSS','RSVR','RTX','RUBY','RUN','RUSHA','RUSHB','RUTH','RVI','RVLV','RVMD','RVNC','RVP','RVPH','RVSB','RWT','RXDX','RXN','RXRX','RXST','RXT','RYAM','RYAN','RYI','RYN','RYTM','RZLT','S','SABR','SACH','SAFE','SAFM','SAFT','SAGE','SAH','SAIA','SAIC','SAIL','SAL','SALM','SAM','SAMG','SANA','SANM','SANW','SASR','SATS','SAVA','SAVE','SB','SBAC','SBCF','SBFG','SBGI','SBH','SBNY','SBOW','SBRA','SBSI','SBT','SBTX','SBUX','SC','SCCO','SCHL','SCHN','SCHW','SCI','SCKT','SCL','SCOR','SCPH','SCPL','SCS','SCSC','SCU','SCVL','SCWX','SCX','SCYX','SD','SDC','SDGR','SEAC','SEAS','SEB','SEE','SEEL','SEER','SEIC','SELB','SELF','SEM','SEMR','SENEA','SENS','SERA','SERV','SESN','SF','SFBC','SFBS','SFE','SFIX','SFL','SFM','SFNC','SFST','SFT','SGA','SGBX','SGC','SGEN','SGFY','SGH','SGHT','SGLB','SGMA','SGMO','SGMS','SGRY','SGTX','SHAK','SHBI','SHC','SHEL','SHEN','SHLS','SHO','SHOO','SHW','SHYF','SI','SIBN','SIEN','SIF','SIG','SIGA','SIGI','SILK','SINT','SIOX','SIRI','SITC','SITE','SITM','SIVB','SIX','SJI','SJM','SJW','SKIL','SKIN','SKLZ','SKT','SKX','SKY','SKYT','SKYW','SLAB','SLB','SLCA','SLDB','SLG','SLGC','SLGG','SLGN','SLM','SLNG','SLNO','SLP','SLQT','SLRX','SLS','SM','SMAR','SMBC','SMBK','SMCI','SMED','SMFR','SMG','SMHI','SMID','SMIT','SMMF','SMMT','SMP','SMPL','SMRT','SMSI','SMTC','SMTI','SNA','SNAP','SNBR','SNCR','SNCY','SND','SNDR','SNDX','SNEX','SNFCA','SNGX','SNOA','SNOW','SNPO','SNPS','SNR','SNSE','SNV','SNX','SO','SOFI','SOHO','SOI','SOLY','SON','SONM','SONN','SONO','SOVO','SP','SPB','SPCE','SPFI','SPG','SPGI','SPIR','SPIR_old','SPKE','SPLK','SPNE','SPNS','SPNT','SPOK','SPPI','SPR','SPRB','SPRO','SPSC','SPT','SPTN','SPWH','SPWR','SPXC','SQ','SQSP','SQZ','SR','SRAX','SRC','SRCE','SRCL','SRDX','SRE','SREV','SRG','SRGA','SRI','SRNE','SRPT','SRRA','SRRK','SRT','SRTS','SRZN','SSB','SSBI','SSD','SSKN','SSNC','SSNT','SSP','SSTI','SSTK','ST','STAA','STAB','STAF','STAG','STAR','STAY','STBA','STC','STCN','STE','STEM','STEP','STER','STFC','STGW','STI','STIM','STKS','STL','STLD','STMP','STNG','STOK','STON','STOR','STRA','STRL','STRM','STRO','STRS','STRT','STSA','STT','STTK','STWD','STX','STXB','STXS','STZ','SUI','SUM','SUMO','SUMR','SUNL','SUNW','SUP','SUPN','SURF','SVC','SVRA','SVT','SWAV','SWBI','SWCH','SWI','SWIM','SWK','SWKH','SWKS','SWM','SWN','SWTX','SWX','SXC','SXI','SXT','SYBT','SYBX','SYF','SYK','SYKE','SYNA','SYNH','SYNL','SYPR','SYRS','SYY','T','TA','TACO','TACT','TAIT','TALK','TALO','TALS','TAP','TARA','TARS','TASK','TAST','TAYD','TBBK','TBI','TBIO','TBK','TBLT','TBNK','TBPH','TCBC','TCBI','TCBK','TCDA','TCF','TCFC','TCMD','TCO','TCON','TCRR','TCRX','TCS','TCX','TDC','TDG','TDOC','TDS','TDUP','TDW','TDY','TEAM','TECH','TEL','TELA','TELL','TEN','TENB','TENX','TER','TERN','TESS','TEX','TFC','TFFP','TFSL','TFX','TG','TGH','TGI','TGNA','TGT','TGTX','TH','THC','THFF','THG','THMO','THO','THR','THRM','THRN','THRY','THS','TIG','TIL','TILE','TIPT','TISI','TITN','TJX','TK','TKNO','TKR','TLIS','TLMD','TLS','TLYS','TMBR','TMCI','TMDX','TMHC','TMO','TMP','TMST','TMUS','TMX','TNC','TNDM','TNET','TNGX','TNK','TNL','TNXP','TNYA','TOL','TOMZ','TOST','TOWN','TPB','TPC','TPCO','TPH','TPHS','TPIC','TPL','TPR','TPST','TPTX','TPX','TR','TRC','TREC','TREE','TREX','TRGP','TRHC','TRIL','TRIP','TRKA','TRMB','TRMK','TRN','TRNO','TRNS','TROW','TROX','TRS','TRST','TRT','TRTN','TRTX','TRU','TRUE','TRUP','TRV','TRVI','TRVN','TSAT','TSBK','TSC','TSCO','TSE','TSHA','TSLA','TSM','TSN','TSP','TSQ','TSRO','TSVT','TT','TTC','TTCF','TTD','TTEC','TTEK','TTGT','TTI','TTMI','TTNP','TTOO','TTSH','TTWO','TUEM','TUP','TUSK','TVTX','TVTY','TW','TWI','TWIN','TWKS','TWLO','TWNK','TWO','TWOU','TWST','TWTR','TXG','TXMD','TXN','TXRH','TXT','TYL','TYME','TZOO','U','UA','UAA','UAL','UAMY','UAVS','UBA','UBER','UBFO','UBOH','UBP','UBSI','UBX','UCBI','UCTT','UDR','UE','UEC','UEIC','UFAB','UFCS','UFI','UFPI','UFPT','UFS','UG','UGI','UGRO','UHAL','UHS','UHT','UI','UIHC','UIS','UL','ULBI','ULCC','ULH','ULTA','ULTI','UMBF','UMH','UMICF','UMPQ','UNB','UNF','UNFI','UNH','UNIT','UNM','UNP','UNTY','UNVR','UONE','UONEK','UP','UPLD','UPS','UPST','UPWK','URBN','URG','URGN','URI','USAK','USAP','USAU','USB','USCB','USCR','USFD','USG','USIO','USLM','USM','USNA','USPH','USWS','USX','UTHR','UTI','UTL','UTMD','UTZ','UUU','UUUU','UVE','UVSP','UVV','UWMC','V','VABK','VAC','VALU','VAPO','VAR','VATE','VBFC','VBIV','VBTX','VC','VCEL','VCNX','VCRA','VCTR','VCYT','VEC','VECO','VEEV','VEI','VEL','VER','VERA','VERB','VERI','VERO','VERU','VERV','VERX','VFC','VG','VGR','VHC','VHI','VIA','VIAC','VIACA','VIAV','VICI','VICR','VIEW','VINC','VIR','VIRC','VIRI','VIRT','VIRX','VISL','VITL','VIVE','VIVO','VKTX','VLDR','VLGEA','VLO','VLTA','VLY','VMC','VMD','VMEO','VMI','VMW','VNCE','VNDA','VNO','VNT','VOLT','VOR','VOXX','VOYA','VPG','VRA','VRAY','VRCA','VRDN','VREX','VRM','VRME','VRNS','VRNT','VRPX','VRRM','VRS','VRSK','VRSN','VRT','VRTS','VRTV','VRTX','VSAT','VSCO','VSEC','VSH','VSM','VST','VSTM','VSTO','VTGN','VTNR','VTOL','VTR','VTRS','VTSI','VTVT','VUZI','VVC','VVI','VVNT','VVOS','VVV','VWTR','VXRT','VYGR','VYNE','VYNT','VZ','VZIO','W','WAB','WABC','WAFD','WAL','WASH','WAT','WATT','WBA','WBC','WBS','WBT','WCC','WCG','WCN','WD','WDAY','WDC','WDFC','WEBR','WEC','WELL','WEN','WERN','WETF','WEX','WEYS','WFC','WFCF','WFRD','WFTLF','WGO','WH','WHD','WHG','WHLR','WHR','WINA','WING','WINT','WIRE','WISA','WISH','WK','WKHS','WLDN','WLFC','WLK','WLL','WLLAW','WLLBW','WLMS','WLTW','WM','WMB','WMC','WMG','WMK','WMPN','WMS','WMT','WNC','WNEB','WOLF','WOOF','WOR','WOW','WP','WPC','WRAP','WRB','WRBY','WRE','WRI','WRK','WRLD','WSBC','WSBF','WSC','WSFS','WSM','WSO','WSR','WST','WSTG','WTBA','WTER','WTFC','WTI','WTM','WTRG','WTRH','WTS','WTT','WTTR','WU','WVE','WVVI','WW','WWD','WWE','WWR','WWW','WY','WYNN','WYY','X','XAIR','XBIT','XCUR','XEC','XEL','XELA','XELB','XENT','XERS','XFOR','XGN','XHR','XL','XLNX','XM','XMTR','XNCR','XOG','XOM','XOMA','XONE','XPEL','XPER','XPL','XPO','XPOF','XPRO','XRAY','XRX','XSPA','XXII','XYL','Y','YCBD','YELL','YELP','YETI','YEXT','YMAB','YMTX','YORW','YOU','YTEN','YUM','YUMC','Z','ZBH','ZBRA','ZD','ZDGE','ZEN','ZEST','ZETA','ZEUS','ZEV','ZG','ZGNX','ZI','ZION','ZIOP','ZIP','ZIXI','ZM','ZNGA','ZNTL','ZOM','ZS','ZSAN','ZTS','ZUMZ','ZUO','ZVIA','ZVO','ZWS','ZY','ZYNE','ZYXI']
    workload = len(etf_tickers)

    print(f'Started etf update, workload: {workload}')

    for ticker in tqdm(etf_tickers):
        try:

            for i in range(10):
                try:
                    url = API_URL + \
                        f'fundamentals/{ticker}?api_token={API_TOKEN}&fmt=json'

                    response = requests.get(url, timeout=60)

                    etf_data = json.loads(response.content)

                    break

                except requests.exceptions.ReadTimeout:
                    if i < 9:
                        continue
                    else:
                        print(f'Too many timeouts at {ticker}.')

            if etf_data is not None:

                holdings = [holding['Code']
                            for holding in etf_data['ETF_Data']['Holdings'].values()]

                if ticker == 'VTI' and len(holdings) > 4000:
                    tickers = holdings

                if len(holdings) > 20:

                    values = {
                        'ticker': ticker,
                        'name': etf_data['General']['Name'],
                        'currency': etf_data['General']['CurrencyCode'],
                        'country': etf_data['General']['CountryName'],
                        'holdings': holdings

                    }

                    sql = f'''
                        INSERT INTO etf(ticker, name, currency, country, holdings) 
                        VALUES(:ticker, :name, :currency, :country, :holdings)
                        ON CONFLICT(ticker) DO
                        UPDATE SET 
                            name = EXCLUDED.name,
                            currency = EXCLUDED.currency,
                            country = EXCLUDED.country,
                            holdings = EXCLUDED.holdings
                        ;
                    '''

                    db.execute(sql, values)
                    db.commit()
        except:
            continue

    print(f'Finished etf update.')

    return tickers
